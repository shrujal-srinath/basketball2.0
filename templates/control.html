<!-- âœ… Updated templates/control.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Control Panel</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Control Panel - Game {{ game.code }}</h1>

    <div class="logos">
        {% if game.home_logo %}<img src="/{{ game.home_logo }}" height="80">{% endif %}
        <strong>{{ game.home_name }}</strong> vs <strong>{{ game.away_name }}</strong>
        {% if game.away_logo %}<img src="/{{ game.away_logo }}" height="80">{% endif %}
    </div>

    <div>
        Game Clock: <input id="game_clock" value="{{ game.game_clock }}">
        Shot Clock: <input id="shot_clock" value="{{ game.shot_clock }}">
        <button onclick="sendClockControl('start')">Start</button>
        <button onclick="sendClockControl('pause')">Pause</button>
        <button onclick="sendClockControl('reset')">Reset</button>
    </div>

    <div>
        <label>Home Score: </label><input id="home_score" value="{{ game.home_score }}">
        <label>Away Score: </label><input id="away_score" value="{{ game.away_score }}">
        <button onclick="updateScore()">Update Score</button>
    </div>

    <div>
        <button onclick="window.location.href='/end/{{ game.code }}'">End Game</button>
    </div>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io();
        const code = "{{ game.code }}";
        socket.emit('join', { code });

        socket.on('game_updated', data => {
            const u = data.updates;
            if (u.game_clock !== undefined) document.getElementById('game_clock').value = u.game_clock;
            if (u.shot_clock !== undefined) document.getElementById('shot_clock').value = u.shot_clock;
            if (u.home_score !== undefined) document.getElementById('home_score').value = u.home_score;
            if (u.away_score !== undefined) document.getElementById('away_score').value = u.away_score;
        });

        function updateScore() {
            socket.emit('update_game', {
                code,
                updates: {
                    home_score: parseInt(document.getElementById('home_score').value),
                    away_score: parseInt(document.getElementById('away_score').value),
                }
            });
        }

        function sendClockControl(action) {
            socket.emit('clock_control', {
                code,
                action
            });
        }
    </script>
</body>
</html>
